---
title: Mocking GraphQL API
---

Mock Service Worker comes with a first-class support for working with a GraphQL API. **This tutorials assumes you have completed the [Getting started](/docs/getting-started) tutorial**, and have the `msw` package installed in your project.

## GraphQL client

This tutorial assumes you have a GraphQL client (Apollo, urql, etc.) installed and configured in your application. You may not necessarily have a GraphQL server yet, and working with MSW does not require you to have one either. A GraphQL client is required in order for your application to properly dispatch GraphQL queries, response to which we are going to mock.

### Which GraphQL clients are supported?

All GraphQL client that comply with the [GraphQL operations specification](TODO) are supported. As long as the client dispatches requests having the following interface it will be supported:

```ts
interface GraphQLRequest {
  query: string
  variables?: Record<string, any>
}
```

> Some GraphQL clients append extra information to the request payload. Additional properties do not affect the mocking procedure, and you can access them in the response resolvers.

## Imports

After the MSW library is installed, let's create a mocks.js module where our mocking definitions would be stored. We would have to import two things from the library:

- `composeMocks()`, a function that describes which operations to mock;
- `graphql`, a namespace that contains utilities for mocking GraphQL API.

```js
import { composeMocks, graphql } from 'msw'
```

## Declaration

Now let's define which GraphQL operations should be mocked. In order to target an operation, use `graphql.query()` or `graphql.mutation()` methods to mock a query or a mutation, respectively. We will start by calling those functions and providing the names of the operations we want to mock.

```js
composeMocks(
  graphql.query('GetUserDetail', null),
  graphql.mutation('Logout', null),
)
```

In the code above we have created two **request handlers**:

- `graphql.query()`, handles the `GetUserDetail` query;
- `graphql.mutation()`, handles the `Logout` mutation.

> You might have noticed that we are not specifying any GraphQL endpoint. MSW intercepts all requests and looks up the mentioned queries/mutations in them, so you don't have to bind the mocking to a specific server endpoint.

You can read about how to work with GraphQL request handlers in more detail below.

> TODO

## Response resolvers

After we define which GraphQL operations should be mocked we have to describe the mocked response. To do so, we must pass the second argument to our `graphql.query()` and `graphql.mutation()` functions. That argument is a [Response resolver](/docs/basics/response-resolver) function that determines the mocked response.

A response resolver function accepts three arguments:

- `req`, an information about the request that happened;
- `res`, a functional utility to compose the next response;
- `context`, a group of utilities to help you get the response you need.

Let's add response resolvers to our existing code:

```js
composeMocks(
  graphql.query('GetUserDetail', (req, res, ctx) => {
    return res(
      ctx.data({
        user: {
          firstName: 'John',
          lastName: 'Maverick',
        },
      }),
    )
  }),

  graphql.mutation('Logout', (req, res, ctx) => {
    return res(
      ctx.errors([
        {
          message: 'This is a mocked error!',
          locations: [
            {
              line: 1,
              column: 2,
            },
          ],
        },
      ]),
    )
  }),
)
```

With the above declaration our `GetUserDetail` query would return the user data, mocking a successful response. The `Logout` mutation, on the other hand, would return a mocked error according to the GraphQL specification.

## Running Service Worker

The result of calling the `composeMocks()` function is a public API object that contains the `start()` function. We need to call that function in order for MSW to start the Service Worker responsible for intercepting requests and mocking their responses.

```js
import { composeMocks, graphql } from 'msw'

const { start } = composeMocks(
  // Our request handlers declared previously
  graphql.query('GetUserDetail', ...),
  graphql.mutation('Logout', ...)
)

// Calling the "start" function registers the Service Worker
start()
```

Upon refreshing the page you should see the confirmation message in the browser's console that the Service Worker is activated. Any operations happening on the page are now going through the MSW and can be mocked according to the defined request handlers.

> TODO Add a screenshot showing the successful activation message from MSW in the browser's console.

## Verify & Inspect

With the Service Worker active and running, dispatch a GraphQL operation that would match any of those defined in the mocks to see the mocking in action.

Here's an example of how to perform a `GetUserDetail` query using Apollo client:

```js
import { gql } from 'graphql-tag'
import { ApolloClient } from 'apollo-client'
import { InMemoryCache } from 'apollo-cache-inmemory'
import { HttpLink } from 'apollo-link-http'

const cache = new InMemoryCache()
const link = new HttpLink({
  uri: 'http://localhost:8080/graphql',
})

const client = new ApolloClient({
  cache,
  link,
})

const GET_USER_DETAIL = gql`
  query GetUserDetail {
    user {
      firstName
      lastName
    }
  }
`

client.query({
  query: GET_USER_DETAIL,
})
```

> The way to perform GraphQL operations depends on the GraphQL client. Please follow the respective instructions of the client you are using.

Open your DevTools in your browser and go to the "Network" tab. There you find the dispatched request and notice that the response has a `200 OK (from ServiceWorker)` status text.

> TODO Add the image

Congratulations! You've now configured a client-side mocking for your GraphQL API. Continue reading about the library's concepts and functionality to enhance your developer experience.
